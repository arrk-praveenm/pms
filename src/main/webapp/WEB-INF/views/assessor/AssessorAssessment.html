<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="home/homeSignedIn">
<head>
<script th:inline="javascript">
$(document).ready(function(){


	 if([[${assessorAssessees}]]==null)
		 {
		 //for employee screen
		 $("#selectAssesseeRow").hide();
		 $("#margin").hide();
		 //selectRoleRow
		 if([[${allObjectives}]]!=null)
			 {
			 $("#selectRoleRow").hide();
			 }else{
		 $("#selectedAssesseeSummary").hide();
		 $("#selectedAssesseeBody").hide();
		 $("#margin").hide();	
			 }	 
		 }
	 else{
	//	//for Assessor screen
	
	 $("#selectRoleRow").hide();
		 $("#selectedAssesseeSummary").hide();
		 $("#selectedAssesseeBody").hide();
		 $("#margin").hide();
		
			
		 }

	// on select of Assessee
$("#selectAssessee").on('change', function(){
	if($("#selectAssessee").val()!=0)
  	 {	
	$("#0").trigger("click");
	$( "#0" ).trigger( "click" );

	
	var data={selectedAsseesseID:$("#selectAssessee").val(),
			sectionToLoad:$("#0").attr("name"),
			role_id:$(selectAssessee).children(":selected").attr("name")
			};
	
	
	 ajaxCall(data);
  	 }else{
  		 $("#selectedAssesseeSummary").hide();
		 $("#selectedAssesseeBody").hide();
		 $("#margin").hide();
		}
	//alert($("#selectAssessee").val());
	});
//on  Select of Role
$("#selectRoleRow").on('change', function(){
	alert("Test");
	/* if($("#selectRoleRow").val()!=0)
  	 {	
	$("#0").trigger("click");
	$( "#0" ).trigger( "click" );

	
	var data={selectedAsseesseID:$("#selectRoleRow").val(),
			sectionToLoad:$("#0").attr("name"),
			role_id:$(selectAssessee).children(":selected").attr("name")
			};
	
	
	 ajaxCall(data);
  	 }else{
  		 $("#selectedAssesseeSummary").hide();
		 $("#selectedAssesseeBody").hide();
		 $("#margin").hide();
		} */
	//alert($("#selectAssessee").val());
	});

$(".test").on("click",function(){

	var id = $(selectAssessee).children(":selected").attr("name");
	

	
	if($("#selectAssessee").val()==0)
   	 {	
		var data={selectedAsseesseID:0,
				sectionToLoad:$(this).attr("name"),
				role_id:$(selectAssessee).children(":selected").attr("name")
			
				};
		 ajaxCall(data);
	
   	}else
   		{
	 
	
	
	$("#tbody").empty();
	
	var data={selectedAsseesseID:$("#selectAssessee").val(),
			sectionToLoad:$(this).attr("name"),
			role_id:$(selectAssessee).children(":selected").attr("name")
		
			};
	 ajaxCall(data);
	 $("#sectionid").val($(this).attr("name"));
	 
   		}
});
	

function ajaxCall(data)
{


	
	
	
	   $.ajax({
           url: "ajax/assesseeObjectives",
           type: 'GET',
           data: data,
           success: function(response) {
        	  
        	   
        	   
			if(response=="")
           {
		           if(data.selectedAsseesseID==0)
			           {
						 $("#selectedAssesseeSummary").hide();
						 $("#selectedAssesseeBody").hide();
						 $("#margin").hide();
			           }
		           $("#selectedAssesseeSummary").show();
					 $("#selectedAssesseeBody").show();
					 $("#margin").show();
		           
				 $("#tbody").empty();
           }else{
        	   
        	   $("#selectedAssesseeSummary").show();
				 $("#selectedAssesseeBody").show();
				 $("#margin").show();

           	 $("#tbody").empty();
                    	 
    
           	 
             for (row in response) {
            	 var objective="objective"+response[row].id;
            	 var weightage="weightage"+response[row].id;
            	 var selfRating="selfRating"+response[row].id;
            	 var selfScore="selfScore"+response[row].id;
            	 var managerRating="managerRating"+response[row].id;
            	 var managerScore="managerScore"+response[row].id;
            var btn="btn"+response[row].id;
            	 
            	 
            	 
            	 var classValue=" text-center";
            	 
            	  var rowdata = $(  "<tr id="+ response[row].id +" />")
      		    $("#objective_table").append(rowdata); 
      		    rowdata.append($("<td id="+objective+">" + response[row].description + "</td>"));
      		    rowdata.append($("<td id="+weightage+" class="+classValue+">" + response[row].weightage.weightage + "</td>"));
      		    rowdata.append($("<td id="+selfRating+" class="+classValue+">" + response[row].self_rating.score + "</td>"));
      		    rowdata.append($("<td id="+selfScore+" class="+classValue+">" + response[row].self_score + "</td>"));
    		    rowdata.append($("<td id="+managerRating+" class="+classValue+">" + response[row].manager_rating.score + "</td>"));
    		    rowdata.append($("<td id="+managerScore+" class="+classValue+">" + response[row].manager_score + "</td>"));
    		     rowdata.append($("<td>" + '<button id="'+btn+'" name="'+response[row].id+'"  class="btn btn-info btn-edit" data-toggle="modal" data-target="#managermodal" type="button"><i class="fa fa-pencil"></i></button>' + "</td>")); 
    		   
    		   /*   '<input type="hidden" id="'+hiddenObjectiveId+'" name="deleteObjectiveId" value="'+objectiveDesc.id+'"/>' */
    		     /* <button class="btn btn-info btn-edit" data-toggle="modal" data-target="#managermodal" type="button"><i class="fa fa-pencil"></i></button> */
    		   
             }
           	 
             
             
		     $(".btn-edit").on( "click", function(){
		    		
		    	 
		    	  
		    /* 	 alert("test"+$(this).attr("name"));
		    	 
		    	 var objectivecopy='#'+'objectiveDesc'+iterStat;
		    	  */
		    	  var objective_id='#'+'objective'+$(this).attr("name");
		    	  var weightage_id='#'+'weightage'+$(this).attr("name");
		    	  var managerRating_id='#'+'managerRating'+$(this).attr("name");
		    	  var managerScore_id='#'+'managerScore'+$(this).attr("name");
		    	/*   var managercomment='#'+'managerScore'+$(this).attr("name"); */
		    	    var selfRating_id='#'+'selfRating'+$(this).attr("name");
		    	  var selfScore_id='#'+'selfScore'+$(this).attr("name");
		    	  

		    	  $("#objective_modal").val($(objective_id).text());
		    	  $("#weightage").val($(weightage_id).text());
		    	  $("#manager_rating").val($(managerRating_id).text());
		    	  $("#manager_score").val($(managerScore_id).text());
		    	  $("#selfrating").val($(selfRating_id).text());
		    	  $("#selfscore").val($(selfScore_id).text());
		    	  $("#objectiveid").val($(this).attr("name"));
		    	  
		    	  
		    	  
		    	  if([[${#authorization.expression('hasAnyRole(''ASSESSOR'',''MANAGER'')')}]])
		 		 {
		 		$("#objectiveSection").children().prop('disabled',true);
		 		$("#employeeSection").find("input,textarea").prop("disabled",true);
		 		$("#manager_score").prop("disabled",true);
		 		$("#objective_modal").prop("disabled",true);
		 		$("#weightage").prop("disabled",true);
		 	
		 		
		 		 }
		    	  
		    	  
		    	  
		    	  }); 
           	 
            
           } 

            
           },
           error: function(jqXHr, reponse, errorThrown) {
               // ... Process the result ...
               alert(errorThrown);
           }
		}); 
		//ajax function ends 
	
   		
   		};
	


	
	


	 	
	 	
	 	
	 	
$(".text-center").on('click',function(){
	alert($(this).attr("id"));
	var objectiveDesc="objectiveDesc"+$(this).attr("id");
	var wightage="wightage"+$(this).attr("id");
	var selfRating="selfRating"+$(this).attr("id");
	var selfScore="selfScore"+$(this).attr("id");
	var managerRating="managerRating"+$(this).attr("id");
	var managerScore="managerScore"+$(this).attr("id");

	 if([[${#authorization.expression('hasAnyRole(''ASSESSOR'',''MANAGER'')')}]])
		 {
		$("#objectiveSection").children().prop('disabled',true);
		$("#employeeSection").find("input,textarea").prop("disabled",true);
		
		 }
});





	//Document close
});
</script>

</head>
<body>
	<div layout:fragment="content">
	
	 <!-- Content Wrapper starts -->
      <div >
        <!-- Content Header starts -->
        <section class="content-header">
          <h1>Manager</h1>
          <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-home"></i> Home</a></li>
            <li class="active">Here</li>
          </ol>
        </section>
		<!-- Content Header ends -->

        <!-- Main content starts -->
        <section class="content">
			

			<!-- Manager header panel starts -->
			<div class="box">
				<div class="box-body">
					<div class="row margintop15" id="selectAssesseeRow">
							<div class="col-md-6">
								<div class="form-group">
									<select class="form-control" id="selectAssessee" th:name="${selectedAsseses}" >								
									
										<option selected="selected" value="0">Select Employee</option>
										<option th:each="assessor : ${assessorAssessees}" th:text="${assessor.fullname}" th:value="${assessor.id}" th:name="${assessor.role_id}">Employee one</option>
										
									</select>
								</div>
							</div>
							<div class="col-md-6">

							</div>
						</div>
						
						<div class="row margintop15" id="selectRoleRow">
							<div class="col-md-6">
								<div class="form-group">
									<select class="form-control" id="selectRole" th:name="${selectedRole}" >								
									
										<option selected="selected" value="0">Select Role</option>
										<option th:each="role : ${allRolesofCurrentUser}" th:text="${role.title}" th:value="${role.id}" th:name="${role.id}">Role</option>
										
									</select>
								</div>
							</div>
							<div class="col-md-6">

							</div>
						</div>
					
					<hr class="margintop10"  id="margin"/>
						<div class="form-group text-right" id="selectedAssesseeSummary">
							<button class="btn btn-info btn-green" type="button" data-target="#summaryrating" data-toggle="modal"><i class="fa fa-file-text">&nbsp;</i> Summary Ratings</button>
						</div>
					
					<div class="nav-tabs-custom margintop10 noboxshadow" id="selectedAssesseeBody">
						<div class="scroller scroller-left"><i class="glyphicon glyphicon-chevron-left"></i></div>
						<div class="scroller scroller-right"><i class="glyphicon glyphicon-chevron-right"></i></div>
						<div class="wrapper-tabs">
							<ul class="nav nav-tabs list" id="myTab" >
							<th:block th:each="section, iterStat : ${allSections}">
								<li th:if="${iterStat.index}==0" class="test active" th:id="${iterStat.index}" th:name="${section.getId()}"><a data-toggle="tab" href="#par" th:text="${section.getSection()}">Performance</a></li>
							
								<li th:if="${iterStat.index}!=0" th:id="${iterStat.index}" th:name="${section.getId()}" class="test"><a data-toggle="tab" href="#car" th:text="${section.getSection()}">Competancy</a></li>
								</th:block>
								<!-- <li><a data-toggle="tab" href="#pqar">Personal Qualities</a></li> -->
							</ul>
						</div>
						<div class="tab-content">
							<div id="par" class="tab-pane active">
								
								<div class="box-body table-responsive">
									<table id="objective_table" class="table">
										<thead>
											<tr>
												<th>Objectives</th>
												<th>Weightage</th>
												<th>Self Rating</th>
												<th>Self Score</th>
												<th>Manager Rating</th>
												<th>Manager Score</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody id="tbody">
										<th:block th:each="objective,itrIndex: ${allObjectives}">
											<tr id="tRow" th:name="${objective.getId()}">
												<td class="col-md-10 col-xs-7" th:text="${objective.description}" th:id="'objectiveDesc'+${objective.getId()}">
													Delivering to the Customer's satisfaction/ expectation
												</td>
												<td class="col-md-1 col-xs-3 text-center" th:id="'wightage'+${objective.weightage.weightage}">
													0
												</td>
												<td class="col-md-1 col-xs-3 text-center" th:id="'selfRating'+${objective.self_rating.score}">
													0
												</td>
												<td class="col-md-1 col-xs-3 text-center" th:id="'selfScore'+${objective.self_score}">
													0
												</td>
												<td class="col-md-1 col-xs-3 text-center" th:id="'managerRating'+${objective.manager_rating.score}">
													0
												</td>
												<td class="col-md-1 col-xs-3 text-center" th:id="'managerScore'+${objective.manager_score}">
													0
												</td>
												<td class="col-md-1 col-xs-1 text-center" th:id="${objective.getId()}">
													<button class="btn btn-info btn-edit" data-toggle="modal" data-target="#managermodal" type="button"><i class="fa fa-pencil"></i></button>
												</td>
											</tr>
										</th:block>
										</tbody>
									</table>
								</div>

							<div class="clearfix"></div>
							</div>
							

						
							
							
						</div>
						
						<div class="form-group margintop30 text-center">
								<!-- <button class="btn btn-danger btn-lg" type="submit"><i class="fa fa-times"></i> Close</button> -->
								<button class="btn btn-primary btn-lg" type="submit"><i class="fa fa-check"></i>
 Submit</button>
							</div>
							
							
						
					</div>
					
					
					
					
					
				</div>
			</div>
			<!-- Manager header panel ends -->
			  

        </section>
		<!-- Main content ends -->
      </div>
	<!-- Content Wrapper ends -->
	<!-- Manager Modal Starts -->
		
		<form method="post" action="#"
						th:action="@{/assessor/SaveSectionData}"
						th:object="${SectionDataBean}">
						
						
						<input type="hidden" id="objectiveid" name="objectiveid"
							th:field="*{objectiveid}" th:value="${objectiveid}" />
						
						<input type="hidden" id="employee_assessor_id" name="employee_assessor_id"
							th:field="*{employee_assessor_id}" th:value="${employee_assessor_id}" />
						
										
										
							<input type="hidden" id="sectionid" name="sectionid"
							th:field="*{sectionid}" th:value="${sectionid}" />
						
						
		
		<div class="modal fade" id="managermodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">Add Ratings and Comments</h4>
					</div>
					  <div class="modal-body">
						  <div class="row" id="objectiveSection">
							<div class="col-md-9">
								<div class="form-group" id="objectiveDesc">
									<label class="sr-only">Objectives</label>
									<textarea id="objective_modal"  row="2" class="form-control" Placeholder="Objectives"></textarea>
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group" id="wightage">
									<label class="sr-only">Weightage</label>
									<input id="weightage" type="text" class="form-control" Placeholder="weightage" />
								</div>
							</div>
						  </div>
						  
						 
						  <div class="row" id="employeeSection">
							<div class="col-md-12">
								<h4>Assesse Self Rating</h4>
								<hr class="marginbottom15 margintop5"/>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label class="sr-only">Self Rating</label>
									<input id="selfrating" type="text" class="form-control" Placeholder="Self Rating" />
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label class="sr-only">Self Score</label>
									<input id="selfscore" type="text" class="form-control" Placeholder="Self Score" />
								</div>
							</div>
							<div class="col-md-6"></div>
							<div class="col-md-12">
								<div class="form-group">
									<label class="sr-only">Employee Comments</label>
									<textarea id="comments" row="2" class="form-control" Placeholder="Employee Comments"></textarea>
								</div>
							</div>
						  </div>
						 
						   <div class="row" id="managerSection">
							<div class="col-md-12">
								<h4>Assessor Rating</h4>
								<hr class="marginbottom15 margintop5"/>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label class="sr-only">Manager Rating</label>
									<input id="manager_rating"  th:field="*{manager_rating}"  type="text" class="form-control" Placeholder="Manager Rating" />
								</div>
							</div>
							<div class="col-md-3">
								<div class="form-group">
									<label class="sr-only">Manager Score</label>
									<input id="manager_score" type="text" class="form-control" Placeholder="Manager Score" />
								</div>
							</div>
							<div class="col-md-6"></div>
							<div class="col-md-12">
								<div class="form-group">
									<label class="sr-only">Manager Comments</label>
									<textarea id="manager_comments" th:field="*{manager_comments}" row="2" class="form-control" Placeholder="Manager Comments"></textarea>
								</div>
							</div>
						  </div>
						  
					  </div>
					  <div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
						<button type="submit" class="btn btn-primary"><i class="fa fa-check"></i> Save</button>
					  </div>
				</div>
			</div>
		</div>
		</form>
		
		
		
		
		<!-- Manager Modal ends -->



	<!-- Summary Rating Modal Starts -->
		<div class="modal fade" id="summaryrating" tabindex="-1" role="dialog" aria-labelledby="summaryratinglabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="summaryratinglabel">Summary Rating</h4>
					</div>
					  <div class="modal-body">
							<div class="row margintop0">
								<div class="padding10">
									<h4 class="margintop0 marginbottom5"><strong>Organisation weightage of different parameters</strong></h4>
									
									<p class="label label-info score-container">
										<em class="score-title">Performance</em>
										<em class="score">0.4</em>
									</p>
									<p class="label label-info score-container">
										<em class="score-title">Competency</em>
										<em class="score">0.4</em>
									</p>
									<p class="label label-info score-container">
										<em class="score-title">Personal Qualities</em>
										<em class="score">0.2</em>
									</p>
								</div>
							</div>
							<div class="row">
								<div class="padding10">
								
								<h4 class="margintop0 marginbottom5"><strong>Summary Score</strong></h4>
									<p class="label label-success score-container">
										<em style="word-wrap: break-word; white-space: normal;" class="score-title">Performance Assessment</em>
										<em class="score">0.4</em>
									</p>
									<p class="label label-success score-container">
										<em class="score-title">Competency Assessment</em>
										<em class="score">0.4</em>
									</p>
									<p class="label label-success score-container">
										<em class="score-title">Personal Qualities Accessment</em>
										<em class="score">0.2</em>
									</p>
									<p class="label label-success score-container">
										<em class="score-title">Weightage Score</em>
										<em class="score">0.2</em>
									</p>
									<p class="label label-success score-container">
										<em class="score-title">Normalised Score</em>
										<em class="score">0.3</em>
									</p>
								</div>
							</div>
					  </div>
					  <div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
					  </div>
				</div>
			</div>
		</div>
	</div>
	</body>
	</html>